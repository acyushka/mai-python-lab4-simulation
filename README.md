#  Симуляция с пользовательсĸими ĸоллеĸциями и псевдослучайной моделью

## Введение

Симуляция событий в подпольном Казино, управляемом гусями.

Реализован класс Casino, включающий 4 коллекции:
    - Игроков (через композицию)
    - Гусей (через композицию)
    - Балансов Игроков (наследование от UserDict)
    - Доходов Гусей (наследование от UserDict)

При каждом шаге в run_simulation вызывается метод step() у казино, в котором выбирается одно из случайных событий класса:
    - Регистрация игрока
    - Регистрация гуся
    - Ставка игрока с результатом (шанс на выигрыш 10%)
    - Крик HonkGoose, который отнимает у всех игроков немного денег
    - Удар дубиной WarGoose по одному из игроков
    - Налет группы гусей(объединение коллекций гусей через \_\_add__), у всех отнимается хп
    - Паника у случайного игрока при виде дубинки боевого гуся (убегает из казино)
    - Лечение игрока (находит энергетик под столом)

У Player есть поля balance и hp(всегда 100 с начала), если одно из них будет <= 0, все упоминания о нем исчезнут из коллекций.

## Архитектура проекта

```shell
project/
├── src/
│   ├── collections/ # пользовательские коллекции
│   │   ├── balance.py        # балансы игроков (словарная)
│   │   ├── goose.py          # гуси (списковая)
│   │   ├── gooses_income.py  # доходы гусей (словарная)
│   │   └── player.py         # игроки (списковая)
│   ├── models/      # пользовательские классы сущностей
│   │   ├── chips.py          # фишки
│   │   ├── gooses.py         # гуси
│   │   └── player.py         # игроки
│   ├── services/    # главная бизнес-логика
│   │   └── casino.py         # класс Casino, run_simulation
│   └── main.py               # запуск симуляции, Typer
├── tests/
│   ├── test_casino.py
│   └── test_collections.py
├── .gitignore
├── .pre-commit-config.yaml   # Линтеры и тп
├── pyproject.toml            # Настройки и описание проекта
├── requirements.txt          # Зависимости
└── README.md                 # Документация
```

## Запуск

1) Форкаем репозиторий:

```shell
git clone <ссылка на репозиторий>
```

3) Создаем и активируем дефолтное виртуальное окружение и импортируем зависимости из requirements.txt

4) Прописываем команду тайпера run -s {число шагов} --seed {сид} или demo (где уже указаны параметры для демонстрации)

Примеры:

```shell
python -m src.main run -s 16 --seed 99
```
```shell
python -m src.main demo
```

## Тесты

Было написано 22 теста. Протестировал только важные компоненты бизнес-логики, примитивные сущности не тестировал отдельно.

Для запуска нужно:

```shell
pytest tests -vv
```

## Формат вывода

Помечаю в консоли сверху и снизу начало и конец шага, соответственно

Внутри тела шага, сначала идут логи, потом называется событие
Пример при вводе "python -m src.main demo":
```shell
  + Игрок
  + Игрок
  + Игрок
  + Игрок
  + Гусь
  + Гусь

══════════════════════════════ [ШАГ 1] ════════════════════════════════════
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]
  Баланс игрока Саня: 100 -> 21
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]

[СОБЫТИЕ] Игрок Саня поставил $79 и ставка не залетела.. [СОБЫТИЕ]
══════════════════════════════ [ШАГ 1] ════════════════════════════════════

══════════════════════════════ [ШАГ 2] ════════════════════════════════════
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]
  Баланс игрока Саня: 21 -> 16
  Гусь Клык заработал: 0 -> 5
  Баланс игрока Вован: 220 -> 215
  Гусь Клык заработал: 5 -> 10
  Баланс игрока zxc_иван: 320 -> 315
  Гусь Клык заработал: 10 -> 15
  Баланс игрока Иоанн: 65 -> 60
  Гусь Клык заработал: 15 -> 20
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]

[СОБЫТИЕ] Гусь Клык издал крик громкостью 5. Пострадало 4 игроков! [СОБЫТИЕ]
══════════════════════════════ [ШАГ 2] ════════════════════════════════════

══════════════════════════════ [ШАГ 3] ════════════════════════════════════
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]
  + Игрок
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]

[СОБЫТИЕ] Игрок Герасим сел за стол (HP: 100, Баланс: $305) [СОБЫТИЕ]
══════════════════════════════ [ШАГ 3] ════════════════════════════════════

══════════════════════════════ [ШАГ 4] ════════════════════════════════════
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]
  Баланс игрока Герасим: 305 -> 294
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]

[СОБЫТИЕ] Игрок Герасим поставил $11 и ставка не залетела.. [СОБЫТИЕ]
══════════════════════════════ [ШАГ 4] ════════════════════════════════════

══════════════════════════════ [ШАГ 5] ════════════════════════════════════
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]
  HP игрока Саня: 100 -> 60
  HP игрока Вован: 100 -> 60
  HP игрока zxc_иван: 100 -> 60
  HP игрока Иоанн: 100 -> 60
  HP игрока Герасим: 100 -> 60
[ИЗМЕНЕНИЯ ПОСЛЕ СОБЫТИЯ]

[СОБЫТИЕ] Неожиданно из-за угла вылетела орава гусей! HP всех игроков уменьшилось на 40!  [СОБЫТИЕ]
══════════════════════════════ [ШАГ 5] ════════════════════════════════════
```